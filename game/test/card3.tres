[gd_resource type="ShaderMaterial" load_steps=4 format=2]

[sub_resource type="Shader" id=9]
code = "shader_type spatial;
render_mode depth_draw_alpha_prepass;

uniform vec4 albedo : hint_color;
uniform sampler2D stencil;
uniform sampler2D obj_stencil;
uniform vec4 stencil_color : hint_color;

void fragment() {
	vec4 stencil_test = texture(stencil, SCREEN_UV);
	vec4 color_test = stencil_color;
	
	float stencil_id = stencil_test.r * 10.0 + stencil_test.g + 100.0 * stencil_test.b + 1000.0;
	float mask_id = stencil_color.r * 10.0 + stencil_color.g + 100.0 * stencil_color.b + 1000.0;
	
	float mask_result = abs(stencil_id - mask_id);
	
	vec4 obj_stencil_test = texture(obj_stencil, SCREEN_UV);
	
	if (mask_result == 0.0) {
		ALPHA = 0.0;
	} else {
		ALPHA = albedo.a;
		ALBEDO = albedo.rgb;
	}
}"

[sub_resource type="ViewportTexture" id=10]
viewport_path = NodePath("StencilView2")

[sub_resource type="ViewportTexture" id=8]
viewport_path = NodePath("StencilView")

[resource]
resource_local_to_scene = true
shader = SubResource( 9 )
shader_param/albedo = Color( 0.882353, 0.972549, 0, 1 )
shader_param/stencil_color = Color( 1, 1, 1, 1 )
shader_param/stencil = SubResource( 8 )
shader_param/obj_stencil = SubResource( 10 )
